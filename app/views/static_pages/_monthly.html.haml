.row
  .col-md-12
    .page-header
      %h1 Monthly Sales

%table.table.table-condensed.table-hover
  %tr
    %th For the month of
    %td
    %td= @report_date.strftime("%B")
    / %td= Date.today.strftime("%B")
  %tr
    %th Specials
    %th Quantity
    %th Item Price
    %th Sold per Item
  - Product.where(:category=>"Special").each do |prod|
    - @total = 0
    - @item_qty = 0
    %tr
      %td= prod.item_name
      - OrderSlip.where("created_at >= ? and created_at < ? and open = ?", Date.today.beginning_of_month, Date.today.end_of_month, false).each do |tab|
        - tab.order_slip_items.each do |tab_item|
          - if (prod.item_name == Product.find(tab_item.product_id).item_name)
            - @item_qty = @item_qty + tab_item.quantity
      %td= @item_qty
      %td= number_with_precision(prod.price, precision: 2)
      - @items_sold = @item_qty * prod.price
      %td= number_with_precision(@items_sold, precision: 2)
    - @total = @total + @items_sold

  %tr
    %th Silog
    %th
    %th
    %th
  - Product.where(:category=>"Silog").each do |prod|
    - @item_qty = 0
    %tr
      %td= prod.item_name
      - OrderSlip.where("created_at >= ? and created_at < ? and open = ?", Date.today.beginning_of_month, Date.today.end_of_month, false).each do |tab|
        - tab.order_slip_items.each do |tab_item|
          - if (prod.item_name == Product.find(tab_item.product_id).item_name)
            - @item_qty = @item_qty + tab_item.quantity
      %td= @item_qty
      %td= number_with_precision(prod.price, precision: 2)
      - @items_sold = @item_qty * prod.price
      %td= number_with_precision(@items_sold, precision: 2)      
    - @total = @total + @items_sold

  %tr
    %th Classic
    %th 
    %th
    %th
  - Product.where(:category=>"Classic").each do |prod|
    - @item_qty = 0
    %tr
      %td= prod.item_name
      - OrderSlip.where("created_at >= ? and created_at < ? and open = ?", Date.today.beginning_of_month, Date.today.end_of_month, false).each do |tab|
        - tab.order_slip_items.each do |tab_item|
          - if (prod.item_name == Product.find(tab_item.product_id).item_name)
            - @item_qty = @item_qty + tab_item.quantity
      %td= @item_qty
      %td= number_with_precision(prod.price, precision: 2)
      - @items_sold = @item_qty * prod.price
      %td= number_with_precision(@items_sold, precision: 2)
    - @total = @total + @items_sold

  %tr
    %th Rice Toppings
    %th 
    %th
    %th
  - Product.where(:category=>"Rice Topping").each do |prod|
    - @item_qty = 0
    %tr
      %td= prod.item_name
      - OrderSlip.where("created_at >= ? and created_at < ? and open = ?", Date.today.beginning_of_month, Date.today.end_of_month, false).each do |tab|
        - tab.order_slip_items.each do |tab_item|
          - if (prod.item_name == Product.find(tab_item.product_id).item_name)
            - @item_qty = @item_qty + tab_item.quantity
      %td= @item_qty
      %td= number_with_precision(prod.price, precision: 2)
      - @items_sold = @item_qty * prod.price
      %td= number_with_precision(@items_sold, precision: 2)
    - @total = @total + @items_sold
  
  %tr
    %th Noodles
    %th 
    %th
    %th
  - Product.where(:category=>"Noodles").each do |prod|
    - @item_qty = 0
    %tr
      %td= prod.item_name
      - OrderSlip.where("created_at >= ? and created_at < ? and open = ?", Date.today.beginning_of_month, Date.today.end_of_month, false).each do |tab|
        - tab.order_slip_items.each do |tab_item|
          - if (prod.item_name == Product.find(tab_item.product_id).item_name)
            - @item_qty = @item_qty + tab_item.quantity
      %td= @item_qty
      %td= number_with_precision(prod.price, precision: 2)
      - @items_sold = @item_qty * prod.price
      %td= number_with_precision(@items_sold, precision: 2)
    - @total = @total + @items_sold

  %tr
    %th Sandwich
    %th 
    %th
    %th
  - Product.where(:category=>"Sandwich").each do |prod|
    - @item_qty = 0
    %tr
      %td= prod.item_name
      - OrderSlip.where("created_at >= ? and created_at < ? and open = ?", Date.today.beginning_of_month, Date.today.end_of_month, false).each do |tab|
        - tab.order_slip_items.each do |tab_item|
          - if (prod.item_name == Product.find(tab_item.product_id).item_name)
            - @item_qty = @item_qty + tab_item.quantity
      %td= @item_qty
      %td= number_with_precision(prod.price, precision: 2)
      - @items_sold = @item_qty * prod.price
      %td= number_with_precision(@items_sold, precision: 2)            
    - @total = @total + @items_sold

  %tr
    %th Drink
    %th 
    %th
    %th
  - Product.where(:category=>"Drink").each do |prod|
    - @item_qty = 0
    %tr
      %td= prod.item_name
      - OrderSlip.where("created_at >= ? and created_at < ? and open = ?", Date.today.beginning_of_month, Date.today.end_of_month, false).each do |tab|
        - tab.order_slip_items.each do |tab_item|
          - if (prod.item_name == Product.find(tab_item.product_id).item_name)
            - @item_qty = @item_qty + tab_item.quantity
      %td= @item_qty
      %td= number_with_precision(prod.price, precision: 2)
      - @items_sold = @item_qty * prod.price
      %td= number_with_precision(@items_sold, precision: 2)
    - @total = @total + @items_sold

  %tr
    %th Cigarettes
    %th 
    %th
    %th
  - Product.where(:category=>"Ciegarettes").each do |prod|
    - @item_qty = 0
    %tr
      %td= prod.item_name
      - OrderSlip.where("created_at >= ? and created_at < ? and open = ?", Date.today.beginning_of_month, Date.today.end_of_month, false).each do |tab|
        - tab.order_slip_items.each do |tab_item|
          - if (prod.item_name == Product.find(tab_item.product_id).item_name)
            - @item_qty = @item_qty + tab_item.quantity
      %td= @item_qty
      %td= number_with_precision(prod.price, precision: 2)
      - @items_sold = @item_qty * prod.price
      %td= number_with_precision(@items_sold, precision: 2)
    - @total = @total + @items_sold
 
  %tr
    %th Total Sales
    %td
    %td
    %td= @total